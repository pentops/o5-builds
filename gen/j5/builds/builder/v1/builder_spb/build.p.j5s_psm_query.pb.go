// Code generated by protoc-gen-go-psm. DO NOT EDIT.

package builder_spb

import (
	context "context"
	fmt "fmt"
	j5reflect "github.com/pentops/j5/lib/j5reflect"
	j5schema "github.com/pentops/j5/lib/j5schema"
	psm "github.com/pentops/j5/lib/psm"
	sqrlx "github.com/pentops/sqrlx.go/sqrlx"
)

// State Query Service for %sBuild
// QuerySet is the query set for the Build service.

type BuildPSMQuerySet = psm.StateQuerySet

func NewBuildPSMQuerySet(
	smSpec psm.QuerySpec,
	options psm.StateQueryOptions,
) (*BuildPSMQuerySet, error) {
	return psm.BuildStateQuerySet(smSpec, options)
}

type BuildPSMQuerySpec = psm.QuerySpec

func DefaultBuildPSMQuerySpec(tableSpec psm.QueryTableSpec) BuildPSMQuerySpec {
	return psm.QuerySpec{
		GetMethod: &j5schema.MethodSchema{
			Request:  j5schema.MustObjectSchema((&BuildGetRequest{}).ProtoReflect().Descriptor()),
			Response: j5schema.MustObjectSchema((&BuildGetResponse{}).ProtoReflect().Descriptor()),
		},
		ListMethod: &j5schema.MethodSchema{
			Request:  j5schema.MustObjectSchema((&BuildListRequest{}).ProtoReflect().Descriptor()),
			Response: j5schema.MustObjectSchema((&BuildListResponse{}).ProtoReflect().Descriptor()),
		},
		ListEventsMethod: &j5schema.MethodSchema{
			Request:  j5schema.MustObjectSchema((&BuildEventsRequest{}).ProtoReflect().Descriptor()),
			Response: j5schema.MustObjectSchema((&BuildEventsResponse{}).ProtoReflect().Descriptor()),
		},
		QueryTableSpec: tableSpec,
		ListRequestFilter: func(reqReflect j5reflect.Object) (map[string]interface{}, error) {
			req, ok := reqReflect.Interface().(*BuildListRequest)
			if !ok {
				return nil, fmt.Errorf("expected *BuildListRequest but got %T", req)
			}
			filter := map[string]interface{}{}
			return filter, nil
		},
		ListEventsRequestFilter: func(reqReflect j5reflect.Object) (map[string]interface{}, error) {
			req, ok := reqReflect.Interface().(*BuildEventsRequest)
			if !ok {
				return nil, fmt.Errorf("expected *BuildEventsRequest but got %T", req)
			}
			filter := map[string]interface{}{}
			filter["build_id"] = req.BuildId
			return filter, nil
		},
	}
}

type BuildQueryServiceImpl struct {
	db       sqrlx.Transactor
	querySet *BuildPSMQuerySet
	UnsafeBuildQueryServiceServer
}

var _ BuildQueryServiceServer = &BuildQueryServiceImpl{}

func NewBuildQueryServiceImpl(db sqrlx.Transactor, querySet *BuildPSMQuerySet) *BuildQueryServiceImpl {
	return &BuildQueryServiceImpl{
		db:       db,
		querySet: querySet,
	}
}

func (s *BuildQueryServiceImpl) BuildGet(ctx context.Context, req *BuildGetRequest) (*BuildGetResponse, error) {
	resObject := &BuildGetResponse{}
	err := s.querySet.Get(ctx, s.db, req.J5Object(), resObject.J5Object())
	if err != nil {
		return nil, err
	}
	return resObject, nil
}

func (s *BuildQueryServiceImpl) BuildList(ctx context.Context, req *BuildListRequest) (*BuildListResponse, error) {
	resObject := &BuildListResponse{}
	err := s.querySet.List(ctx, s.db, req.J5Object(), resObject.J5Object())
	if err != nil {
		return nil, err
	}
	return resObject, nil
}

func (s *BuildQueryServiceImpl) BuildEvents(ctx context.Context, req *BuildEventsRequest) (*BuildEventsResponse, error) {
	resObject := &BuildEventsResponse{}
	err := s.querySet.ListEvents(ctx, s.db, req.J5Object(), resObject.J5Object())
	if err != nil {
		return nil, err
	}
	return resObject, nil
}
